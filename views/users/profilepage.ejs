<style>
   

    .profile-container {
        max-width: 1200px;
        margin: 50px auto;
        padding: 20px;
        background-color: #fff;
        border-radius: 8px;
        box-shadow: 0px 0px 20px rgba(0, 0, 0, 0.1);
        display: flex;
        flex-direction: row;
        margin-top: 130px;
    }

    .sidebar {
        flex: 1;
        padding-right: 20px;
        border-right: 2px solid #ddd;
        width: 200px;
        background-color: #f0f0f0;
        padding: 20px;
        border-radius: 8px;
    }

    .sidebar-header {
        text-align: center;
        margin-bottom: 20px;
    }

    .sidebar-links {
        margin-top: 20px;
    }

    .sidebar-links a {
        display: block;
        margin-bottom: 10px;
        padding: 10px 20px;
        font-size: 16px;
        color: #333;
        text-decoration: none;
        transition: background-color 0.3s ease;
        border-radius: 4px;
    }

    .sidebar-links a:hover {
        background-color: #ddd;
    }

    .main-content {
        flex: 2;
        padding-left: 150px;
    }

    .profile-header h1 {
        margin: 0;
        color: #007bff;
        font-size: 24px;
        border-bottom: 2px solid #007bff;
        padding-bottom: 10px;
        margin-bottom: 20px;
    }

    .section-title {
        margin-top: 30px;
        margin-bottom: 20px;
        color: #555;
        font-size: 20px;
    }

    .btn {
        display: inline-block;
        margin-right: 10px;
        margin-bottom: 10px;
        padding: 10px 20px;
        font-size: 14px;
        text-transform: uppercase;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        transition: background-color 0.3s ease;
        text-align: center;
        text-decoration: none;
    }

    .btn-primary {
        background-color: #007bff;
        color: #fff;
    }

    .btn-primary:hover {
        background-color: #0056b3;
    }

    .btn-success {
        background-color: #28a745;
        color: #fff;
    }

    .btn-success:hover {
        background-color: #218838;
    }

    .btn-warning {
        background-color: #ffc107;
        color: #212529;
    }

    .btn-warning:hover {
        background-color: #e0a800;
    }

    .btn-danger {
        background-color: #dc3545;
        color: #fff;
    }

    .btn-danger:hover {
        background-color: #c82333;
    }

    .btn-secondary {
        background-color: #6c757d;
        color: #fff;
    }

    .btn-secondary:hover {
        background-color: #5a6268;
    }

    ul {
        list-style: none;
        padding-left: 0;
    }

    li {
        margin-bottom: 10px;
    }

    a {
        color: #007bff;
        text-decoration: none;
        transition: color 0.3s ease;
    }

    a:hover {
        color: #0056b3;
    }
     /* CSS for Orders */
     .order {
        background-color: #ffffff;
        border: 1px solid #dddddd;
        border-radius: 8px;
        box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
        padding: 20px;
    }

    .order-details {
        margin-bottom: 10px;
    }

    .product-list {
        list-style-type: none;
        padding-left: 0;
    }

    .product {
        margin-bottom: 10px;
    }

    .order-actions {
        text-align: right;
    }

    .btn {
        display: inline-block;
        margin-right: 10px;
        margin-bottom: 10px;
        padding: 10px 20px;
        font-size: 14px;
        text-transform: uppercase;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        transition: background-color 0.3s ease;
        text-align: center;
        text-decoration: none;
    }

    .btn-danger {
        background-color: #dc3545;
        color: #fff;
    }

    .btn-danger:hover {
        background-color: #c82333;
    }
    
.wallet-summary {
    background-color: #f9f9f9;
    border-radius: 10px;
    padding: 20px;
    text-align: center;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    max-width: 300px;
    margin: 0 auto;
}
.wallet-summary p {
    font-weight: 500;
    font-size: 1.2em;
    margin: 10px 0;
    color: #333;
}

.wallet-amount {
    font-size: 1.5em;
    font-weight: bold;
    color: #4CAF50; /* Green color */
}

.view-wallet-btn {
    display: inline-block;
    margin-top: 15px;
    padding: 10px 20px;
    background-color: #4CAF50; /* Green color */
    color: white;
    text-decoration: none;
    border-radius: 5px;
    transition: background-color 0.3s ease;
}

.view-wallet-btn:hover {
    background-color: #45a049; /* Darker green color */
}
 /* Styling for the referral code section */
 .referral-section {
    max-width: 400px; /* Adjust the width as needed */
    margin: 20px auto;
    padding: 20px;
    background-color: #f0f0f0;
    border: 1px solid #ccc;
    border-radius: 8px;
    text-align: center;
  }

  h2 {
    font-size: 1.5em;
    margin-bottom: 10px;
    color: #333;
  }

  p {
    font-size: 1.2em;
    margin-bottom: 20px;
    color: #666;
    font-weight: bold;
  }

  button {
    background-color: #4CAF50;
    color: white;
    border: none;
    padding: 10px 20px;
    text-align: center;
    text-decoration: none;
    display: inline-block;
    font-size: 16px;
    margin-top: 10px;
    cursor: pointer;
    border-radius: 5px;
    transition: background-color 0.3s;
  }

  button:hover {
    background-color: #45a049;
  }

  svg {
    width: 24px;
    height: 24px;
    vertical-align: middle;
    margin-right: 5px;
  }
</style>


<div class="profile-container">
    <div class="sidebar">
        <div class="sidebar-header">
            <h1>Welcome, <%= user.name %></h1>
        </div>
        <div class="sidebar-links">
            <a href="#profile" class="btn btn-primary">Profile of <%= user.name %></a>
            <a href="#address" class="btn btn-success">Address Management</a>
            <a href="#orders" class="btn btn-warning">Order Management</a>
        </div>
        <div class="wallet-summary">
            <p>Wallet Balance: â‚¹ <%= user.wallet.toFixed(2) %></p>
            <a href="/users/wallet/<%= user._id %>">View Wallet</a>
        </div>
        <div class="referral-section">
            <h2>Your Referral Code</h2>
            <p id="referralCode"><%= referralCode %></p>
            <button onclick="copyReferralCode()">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                <path d="M18 1H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V3a2 2 0 00-2-2zm-1 16H7v-1h10zm3-4H4v-1h16zm0-4H4V8h16z"/>
              </svg>
              Copy Referral Code
            </button>
          </div>      
    </div>
    <div class="main-content">
        <!-- User Details -->
        <div id="profile" class="section">
            <h2 class="section-title">Profile of <%= user.name %></h2> 
            <% if (!profile) { %>
                <p><strong>UserName:</strong> <%= user.name %></p>
                <p><strong>Email:</strong> <%= user.email %></p>
              <% } else { %>
                <p><strong>First Name:</strong> <%= profile.firstName %></p>
                <p><strong>Last Name:</strong> <%= profile.lastName %></p>
                <p><strong>Gender:</strong> <%= profile.gender %></p>
                <p><strong>Date Of Birth:</strong> <%= formattedDate %></p>
                <p><strong>UserName:</strong> <%= user.name %></p>
                <p><strong>Email:</strong> <%= user.email %></p>
                <p><strong>Mobile:</strong> <%= profile.phoneNumber %></p>
              <% } %>
            <a href="/users/edit-profile/<%= user._id %>" class="btn btn-primary">Edit Profile</a>
        </div>

        <!-- Address Management -->
        <div id="address" class="section" style="display:none;">
            <h2 class="section-title">Address Of <%= user.name %></h2>
            <% if (address && address.length > 0) { %>
                <ul>
                    <% address.forEach((addr, index) => { %>
                        <li>
                            <strong>Address <%= index + 1 %>:</strong>
                            <ul>
                                <li>Full Name: <%= addr.fullName %></li>
                                <li>Address Line 1: <%= addr.addressLine1 %></li>
                                <li>Address Line 2: <%= addr.addressLine2 %></li>
                                <li>City: <%= addr.city %></li>
                                <li>State: <%= addr.state %></li>
                                <li>Zip Code: <%= addr.zipCode %></li>
                                <li>Country: <%= addr.country %></li>
                                <li>Mobile Number: <%= addr.mobileNumber %></li>
                            </ul>
                            <a href="/users/<%= user._id %>/addresses/<%= addr._id %>/edit" class="btn btn-warning">Edit</a>
                            <a href="javascript:void(0);" class="btn btn-danger" onclick="confirmDelete('<%= addr._id %>')">Delete</a>
                        </li>
                    <% }); %>
                </ul>
            <% } else { %>
                <p>You have not added any address.</p>
            <% } %>
            <a href="/users/add-address/<%= user._id %>" class="btn btn-success">Add Address</a>

            <!-- Multiple Addresses Area -->
            <div class="multiple-addresses" style="margin-top: 20px;">
                <h3>Multiple Addresses</h3>
                <% if (address && address.length > 1) { %>
                    <ul>
                        <% address.forEach((addr, index) => { %>
                            <li><strong>Address <%= index + 1 %>:</strong> <%= addr.addressLine1 %>, <%= addr.addressLine2 %>, <%= addr.city %>, <%= addr.state %>, <%= addr.zipCode %>, <%= addr.country %>, <%= addr.mobileNumber %></li>
                        <% }); %>
                    </ul>
                <% } else { %>
                    <p>You have not added multiple addresses.</p>
                <% } %>
            </div>
        </div>


        <!-- Order Management -->
        <div id="orders" class="section" style="display:none;">
            <h2 class="section-title">Orders Of <%= user.name %></h2>
            <% if (orders && orders.length > 0) { %>
                <% orders.forEach((order, orderIndex) => { %>
                    <div class="order">
                        <h3>Order <%= orderIndex + 1 %></h3>
                        <div class="order-details">
                            <p>Order ID: <%= order._id %></p>
                            <p>Order Date: <%= new Date(order.orderDate).toLocaleDateString() %></p>
                            <p><strong>Total Amount:</strong> â‚¹<%= order.totalAmount.toFixed(2) %></p>
                            <p><strong>Payment Method:</strong> <%= order.paymentMethod %></p>
                            <% if (order.orderStatus === 'Cancelled') { %>
                                <p><strong>Status:</strong> <span style="color: red;"><%= order.orderStatus %></span></p>
                              <% } else if (order.orderStatus === 'Returned') { %>
                                <p><strong>Status:</strong> <span style="color:orange;"><%= order.orderStatus %></span></p>
                              <% } else { %>
                                <p><strong>Order Status:</strong> <%= order.orderStatus %></p>
                                <p><strong>Payment Status:</strong><span style="color: blue;"> <%= order.status %></span></p>
                              <% } %>                              
                        </div>
                        <div class="order-actions">
                            <a href="/users/view-orders/<%= order._id %>" class="btn btn-success" onclick=""">Order Details</a>
                            <a href="javascript:void(0);" class="btn btn-danger" onclick="confirmCancelOrder('<%= order._id %>')">Cancel</a>
                            <% if (order.orderStatus !== 'Cancelled' && order.orderStatus !== 'Returned' && order.orderStatus == 'Delivered') { %>
                                <a href="javascript:void(0);" class="btn btn-warning" onclick="confirmReturn('<%= order._id %>')">Return</a>
                                <a href="javascript:void(0);" class="btn btn-danger" onclick="confirmCancelOrder('<%= order._id %>')">Cancel</a>
                            <% } %>
                            <% if (order.paymentMethod === 'PayPal' && order.status === 'Pending') { %>
                                <a href="javascript:void(0);" class="btn btn-success" onclick="continuePayment('<%= order.checkoutId %>','<%= order.paymentMethod %>','<%= order.address %>',)">Pay</a>
                                <a href="javascript:void(0);" class="btn btn-danger" onclick="confirmCancelOrder('<%= order._id %>')">Cancel</a>
                            <% } else if (order.status === 'Pending') { %>
                                <a href="javascript:void(0);" class="btn btn-danger" onclick="confirmCancelOrder('<%= order._id %>')">Cancel</a>
                            <% } %>
                        </div>
                    </div>
                <% }); %>
            <% } else { %>
                <p>You have not placed any orders.</p>
            <% } %>
        </div>  
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        const sidebarLinks = document.querySelectorAll('.sidebar-links a');

        sidebarLinks.forEach(link => {
            link.addEventListener('click', function(event) {
                event.preventDefault();
                const target = this.getAttribute('href').slice(1); // Remove '#' from href
                showSection(target);
            });
        });

        function showSection(sectionId) {
            const sections = document.querySelectorAll('.main-content > div');
            sections.forEach(section => {
                section.style.display = 'none';
            });
            document.getElementById(sectionId).style.display = 'block';
        }
    });
</script>

<!-- Include jQuery if not already included -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>
    function confirmDelete(addressId) {
        if (confirm("Are you sure you want to delete this address?")) {
            const userId = "<%= user._id %>"; // Get the user ID

            // Make an AJAX request to delete the address from the server
            $.ajax({
                url: `/users/${userId}/addresses/${addressId}/delete`,
                method: 'DELETE',
                success: function(response) {
                    console.log('Address deleted successfully:', response);
                    // Reload the page after successful deletion
                    window.location.reload();
                },
                error: function(xhr, status, error) {
                    console.error('Error deleting address:', error);
                    // Handle error if needed
                }
            });
        }
    }

    function confirmCancelOrder(orderId) {
        if (confirm(`Are you sure you want to cancel this order?${orderId}`)) {
            window.location.href = `/users/cancel-order/${orderId}`;
        }
    }

    function confirmReturn(orderId){
        if(confirm(`Are you sure you want to Return this order?${orderId}`)){
            window.location.href = `/users/return-order/${orderId}`;
        }
    }
</script>

<script>
    function copyReferralCode() {
      const referralCode = document.getElementById('referralCode');
      const codeText = referralCode.textContent.trim(); // Get the text content of the referral code
      
      if (codeText) {
        navigator.clipboard.writeText(codeText)
          .then(() => {
            alert('Referral code copied to clipboard!');
          })
          .catch(err => {
            console.error('Failed to copy: ', err);
            alert('Copy failed. Please try again.');
          });
      }
    }
    </script>

<script>
    function continuePayment(checkoutId,paymentMethod,selectedAddress) {
        const requestData = {
            checkoutId: checkoutId,
            selectedAddress: selectedAddress
        };
    
        if (paymentMethod === 'PayPal') {
            // PayPal payment logic
            $.ajax({
                url: '/paypal/pay',
                method: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(requestData),
                success: function(response) {
                    if (response.approvalUrl) {
                        window.location.href = response.approvalUrl;
                    } else {
                        alert('Failed to initiate PayPal payment');
                    }
                },
                error: function(xhr, status, error) {
                    console.error('Error initiating payment:', error);
                    alert('Failed to initiate payment. Please try again.');
                }
            });
        } else {
            alert('Unsupported payment method.');
        }
    }
    </script>
