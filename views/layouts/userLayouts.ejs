<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %></title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <link href="/styleSheets/userStyles.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/stylesheets/zoomimage.css">
</head>
<body>
    <header>
       <!-- Navbar code -->
     <nav class="navbar navbar-expand-lg navbar-light bg-white fixed-top py-3 shadow">
      <a href="/users/home">
        <h4 class="navbar-brand">
            <i class="fas fa-shoe-prints"></i> Sole Haven
        </h4>
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNavDropdown">
        <ul class="navbar-nav ml-auto">
            <% if (hidelinks !== true) { %>
                <% if (searchbar === true) { %>
                    <li class="nav-item">
                        <form id="searchForm" class="form-inline my-2 my-lg-0">
                            <input id="searchInput" class="form-control mr-sm-2" type="search" placeholder="Search" aria-label="Search">
                            <select id="sortSelect" class="form-control mr-sm-2">
                                <option value="popularity">Popularity</option>
                                <option value="price-asc">Price: Low to High</option>
                                <option value="price-desc">Price: High to Low</option>
                                <option value="ratings">Average Ratings</option>
                                <option value="featured">Featured</option>
                                <option value="new-arrivals">New Arrivals</option>
                                <option value="a-z">A - Z</option>
                                <option value="z-a">Z - A</option>
                            </select>
                            <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
                        </form>
                    </li>                    
                <% } %>
                <li class="nav-item dropdown">
                    <a class="nav-link text-dark" href="/users/shoes">
                        <i class="fas fa-shoe-prints"></i> SHOES
                    </a>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link text-dark" href="/users/slippers">
                        <i class="fas fa-shoe-prints"></i> SLIPPERS
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link text-dark" href="/users/cart">
                        <i class="fas fa-shopping-cart"></i> 
                        <span id="cartCount" class="badge badge-pill badge-success"><%= typeof cartItemCount !== 'undefined' ? cartItemCount : 0 %></span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link text-danger" href="/users/wishlist">
                        <i class="fas fa-heart"></i> 
                    </a>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle text-dark" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <i class="fas fa-user"></i>
                    </a>
                    <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown">
                        <a class="dropdown-item" href="/users/profile/<%= user._id %>">Profile</a>
                        <div class="dropdown-divider"></div>
                        <a class="dropdown-item" href="/users/logout">Logout</a>
                    </div>
                </li>
            <% } else { %>
                <li class="nav-item">
                    <a class="nav-link text-dark" href="/users/login">
                        <i class="fas fa-user"></i> Login/Signup
                    </a>
                </li>
            <% } %>
            <li class="nav-item">
                <a class="nav-link text-dark" href="/users/aboutus">
                    <i class="fas fa-info-circle"></i> About Us
                </a>
            </li>
        </ul>
    </div>
</nav>
    </header>


    <main>
    <div id="content">
        <%- body %>
    </div>
    </main>



    <footer class="py-4 bg-white text-dark border-top">
        <div class="container">
            <div class="row">
                <div class="col-md-4">
                    <h5>Contact Us</h5>
                    <ul class="list-unstyled">
                        <li>Email: solehaven@gmail.com</li>
                        <li>Phone: +91 7356117649</li>
                        <li>Address: Maradu, Ernakulam, Kerala</li>
                    </ul>
                </div>
                <div class="col-md-4">
                    <h5>Quick Links</h5>
                    <ul class="list-unstyled">
                        <li><a href="#">Home</a></li>
                        <li><a href="#">Shop</a></li>
                        <li><a href="#">About Us</a></li>
                        <li><a href="#">Contact</a></li>
                    </ul>
                </div>
                <div class="col-md-4">
                    <h5 class="pl-5">Follow Us</h5>
                    <ul class="list-inline pl-5">
                        <li class="list-inline-item"><a href="#"><i class="fab fa-facebook"></i></a></li>
                        <li class="list-inline-item"><a href="#"><i class="fab fa-twitter"></i></a></li>
                        <li class="list-inline-item"><a href="#"><i class="fab fa-instagram"></i></a></li>
                        <li class="list-inline-item"><a href="#"><i class="fab fa-linkedin"></i></a></li>
                    </ul>
                    <h1><i class="fas fa-shoe-prints"></i>Sole Haven</h1>
                </div>
            </div>
            <hr>
            <div class="text-center">
                <p>&copy; 2024 Sole Haven. All Rights Reserved.</p>
            </div>
        </div>
    </footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="/javascripts/userScripts.js"></script>
    <script src="/javascripts/zoom.js"></script>
    <script>
        $(document).ready(function() {
            $('#searchForm').submit(function(event) {
                event.preventDefault(); // Prevent default form submission behavior
    
                // Get the search query and selected sort option
                const query = $('#searchInput').val();
                const sort = $('#sortSelect').val(); // Get the selected sort option
    
                fetchSearchResults(query, sort);
            });
        });
    
        function fetchSearchResults(query, sort) {
            $.ajax({
                type: 'GET',
                url: '/users/search-product', // Update the URL as per your server route
                data: { query, sort },
                success: function(data) {
                    if (data && data.products && data.products.length > 0) {
                        renderSearchResults(data.products);
                    } else {
                        renderNoResultsMessage();
                    }
                },
                error: function(xhr, status, error) {
                    console.error(error); // Handle errors
                    renderErrorMessage();
                }
            });
        }
    
        function renderSearchResults(products) {
            let content = '';
            products.forEach(product => {
                content += `
                    <div class="col-md-3 col-sm-6 col-12 mb-5">
                        <div class="card">
                            <div id="carousel${product._id}" class="carousel slide product-carousel" data-ride="carousel" data-id="${product._id}">
                                <div class="carousel-inner">
                                    ${product.productImages.map((image, index) => `
                                        <div class="carousel-item ${index === 0 ? 'active' : ''}">
                                            <img src="${image}" class="d-block w-100 card-img-top" alt="Product Image">
                                        </div>
                                    `).join('')}
                                </div>
                                <a class="carousel-control-prev" href="#carousel${product._id}" role="button" data-slide="prev">
                                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                    <span class="sr-only">Previous</span>
                                </a>
                                <a class="carousel-control-next" href="#carousel${product._id}" role="button" data-slide="next">
                                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                    <span class="sr-only">Next</span>
                                </a>
                            </div>
                            <div class="card-body">
                                <h5 class="card-title">${product.brandName}</h5>
                                <p class="card-text font-weight-bold">${product.productName}</p>
                                <p class="card-text"><i class="fas fa-rupee-sign"></i><span>${product.price}</span></p>
                                <p class="card-text">
                                    <span class="stars">
                                        ${Array.from({ length: 5 }, (_, i) => {
                                            if (i < Math.floor(product.starRating)) {
                                                return '<i class="fas fa-star"></i>';
                                            } else if (i === Math.floor(product.starRating) && i < product.starRating) {
                                                return '<i class="fas fa-star-half-alt"></i>';
                                            } else {
                                                return '<i class="far fa-star"></i>';
                                            }
                                        }).join('')}
                                    </span>
                                    <span>(${product.starRating})</span>
                                </p>
                                <!-- Add to Cart Button -->
                                <button class="btn btn-primary btn-add-to-cart" data-product-id="${product._id}">Add to Cart</button>
                                <!-- Wishlist Button with Heart Icon -->
                                <button class="btn btn-outline-danger btn-add-to-wishlist" data-product-id="${product._id}">Wishlist</button>
                            </div>
                        </div>
                    </div>
                `;
            });

               
            $('#content').html(`<div class="container mt-5" ><div class="row searchrow">${content}</div></div>`);
        }
    
        function renderNoResultsMessage() {
            $('#content').html('<p>No search results found.</p>');
        }
    
        function renderErrorMessage() {
            $('#content').html('<p>Error fetching search results. Please try again later.</p>');
        }
    </script>    
</body>
</html>
